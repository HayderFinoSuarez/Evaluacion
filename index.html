<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulario de Evaluación de Licitación con Dashboard</title>
  <style>
    /* --- Estilos previos aquí --- */
    /* Menú superior */
    .menu {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 16px;
      user-select: none;
    }
    .menu button {
      padding: 12px 24px;
      border: none;
      border-radius: 0.5rem 0.5rem 0 0;
      font-weight: 600;
      cursor: pointer;
      background-color: #e0e7ff;
      color: #1e40af;
      transition: background-color 0.3s ease;
    }
    .menu button.active {
      background-color: #2563eb;
      color: white;
      box-shadow: 0 -4px 6px -1px rgba(37, 99, 235, 0.7);
    }
    .menu button:hover:not(.active) {
      background-color: #c7d2fe;
    }
    /* Contenedores para secciones */
    main.contenedor > section {
      display: none;
    }
    main.contenedor > section.active {
      display: block;
    }

    /* Dashboard */
    .dashboard {
      padding: 24px 32px;
      background: #f3f4f6;
      border-radius: 1rem;
      max-width: 960px;
      margin: 0 auto;
      box-shadow: 0 25px 50px -12px rgba(99, 102, 241, 0.25);
    }
    .dashboard h2 {
      color: #2563eb;
      margin-bottom: 16px;
    }
    .estadisticas {
      display: flex;
      justify-content: space-around;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 20px;
    }
    .estadistica {
      background: white;
      padding: 20px 32px;
      border-radius: 0.75rem;
      box-shadow: 0 1px 5px rgb(0 0 0 / 0.1);
      text-align: center;
      flex: 1 1 150px;
    }
    .estadistica .numero {
      font-size: 2.5rem;
      font-weight: 700;
      color: #2563eb;
    }
    .estadistica.cumple .numero {
      color: #16a34a;
    }
    .estadistica.no-cumple .numero {
      color: #ef4444;
    }
    .estadistica.no-evaluado .numero {
      color: #6b7280;
    }
    .estadistica .label {
      font-weight: 600;
      color: #374151;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 0.75rem;
      overflow: hidden;
      box-shadow: 0 1px 5px rgb(0 0 0 / 0.1);
    }
    th, td {
      padding: 12px 16px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      font-size: 0.95rem;
    }
    th {
      background-color: #2563eb;
      color: white;
      font-weight: 700;
    }
    tr:last-child td {
      border-bottom: none;
    }
    td.estado-cumple {
      color: #16a34a;
      font-weight: 600;
    }
    td.estado-no-cumple {
      color: #ef4444;
      font-weight: 600;
    }
    td.estado-no-evaluado {
      color: #6b7280;
      font-style: italic;
    }

  </style>
</head>
<body>
  <!-- Menú para cambiar entre formulario y dashboard -->
  <nav class="menu" role="tablist" aria-label="Menú principal">
    <button role="tab" aria-selected="true" aria-controls="seccionEvaluacion" id="tabEvaluacion" class="active">Evaluación</button>
    <button role="tab" aria-selected="false" aria-controls="seccionDashboard" id="tabDashboard">Dashboard</button>
  </nav>

  <main class="contenedor" role="main" aria-label="Formulario de Evaluación de Licitación">
    <!-- Sección Evaluación -->
    <section id="seccionEvaluacion" class="active" role="tabpanel" tabindex="0" aria-labelledby="tabEvaluacion">
      <!-- (Aquí va TODO tu formulario y contenido actual) -->
      <!-- Encabezado -->
      <header class="encabezado">
        <h1>Formulario de Evaluación de Licitación</h1>
        <p>Evaluación de cumplimiento de requisitos técnicos</p>
      </header>

      <!-- Información Empresa y Evaluador -->
      <section class="seccion-formulario" aria-label="Información de la empresa y evaluador">
        <div>
          <label for="nombreEmpresa">Nombre de la Empresa</label>
          <input id="nombreEmpresa" type="text" placeholder="Ingrese el nombre de la empresa" />
        </div>
        <div>
          <label for="nombreEvaluador">Nombre del Evaluador</label>
          <input id="nombreEvaluador" type="text" placeholder="Ingrese su nombre" />
        </div>
        <div>
          <label for="fechaEvaluacion">
            Fecha
            <span aria-hidden="true">📅</span>
          </label>
          <input id="fechaEvaluacion" type="date" />
        </div>
      </section>

      <!-- Resumen de Puntaje -->
      <section class="resumen-puntaje" aria-live="polite" aria-atomic="true">
        <div class="grupo-puntaje">
          <div class="bloque-puntaje" aria-label="Requisitos cumplidos">
            <div class="puntaje" id="contadorPuntaje">0/22</div>
            <div class="etiqueta">Requisitos Cumplidos</div>
          </div>
          <div class="bloque-puntaje cumplimiento" aria-label="Porcentaje de cumplimiento">
            <div class="puntaje" id="porcentajeCumplimiento">0.0%</div>
            <div class="etiqueta">Cumplimiento</div>
          </div>
        </div>
        <button class="boton-exportar" id="botonExportar" type="button" aria-label="Exportar resultados de evaluación">Exportar Resultados</button>
      </section>

      <!-- Requisitos -->
      <section class="requisitos" aria-label="Lista de requisitos para evaluación">
        <!-- Aquí se inyectarán los requisitos -->
      </section>

      <!-- Observaciones -->
      <section class="observaciones">
        <label for="observaciones">Observaciones:</label>
        <textarea id="observaciones" placeholder="Ingrese observaciones adicionales sobre la evaluación..."></textarea>
      </section>

      <!-- Pie de página -->
      <footer class="pie-pagina">
        <p><strong>Sistema de Puntuación:</strong> CUMPLE = 1 PUNTO | NO CUMPLE = 0 PUNTOS</p>
      </footer>
    </section>

    <!-- Sección Dashboard -->
    <section id="seccionDashboard" role="tabpanel" tabindex="0" aria-labelledby="tabDashboard">
      <div class="dashboard">
        <h2>Dashboard de Resultados de Evaluación</h2>
        <input type="file" id="inputArchivo" accept=".json" aria-label="Importar archivo JSON de evaluación" />
        <div id="mensajeArchivo" role="alert" style="color:#ef4444; margin-top:8px;"></div>

        <div id="resumenDashboard" style="display:none;">
          <div class="estadisticas" aria-live="polite" aria-atomic="true">
            <div class="estadistica cumple">
              <div class="numero" id="numCumple">0</div>
              <div class="label">Cumple</div>
            </div>
            <div class="estadistica no-cumple">
              <div class="numero" id="numNoCumple">0</div>
              <div class="label">No Cumple</div>
            </div>
            <div class="estadistica no-evaluado">
              <div class="numero" id="numNoEvaluado">0</div>
              <div class="label">No Evaluado</div>
            </div>
            <div class="estadistica">
              <div class="numero" id="porcentajeDashboard">0%</div>
              <div class="label">Porcentaje de Cumplimiento</div>
            </div>
          </div>

          <table aria-label="Detalles de requisitos evaluados">
            <thead>
              <tr>
                <th>N°</th>
                <th>Descripción</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody id="tablaResultados">
              <!-- Fila datos aquí -->
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <script>
    (() => {
      // Variables para menú
      const btnEvaluacion = document.getElementById('tabEvaluacion');
      const btnDashboard = document.getElementById('tabDashboard');
      const seccionEvaluacion = document.getElementById('seccionEvaluacion');
      const seccionDashboard = document.getElementById('seccionDashboard');

      function cambiarSeccion(seleccion) {
        if (seleccion === 'evaluacion') {
          btnEvaluacion.classList.add('active');
          btnEvaluacion.setAttribute('aria-selected', 'true');
          btnDashboard.classList.remove('active');
          btnDashboard.setAttribute('aria-selected', 'false');
          seccionEvaluacion.classList.add('active');
          seccionDashboard.classList.remove('active');
          seccionEvaluacion.focus();
        } else {
          btnDashboard.classList.add('active');
          btnDashboard.setAttribute('aria-selected', 'true');
          btnEvaluacion.classList.remove('active');
          btnEvaluacion.setAttribute('aria-selected', 'false');
          seccionDashboard.classList.add('active');
          seccionEvaluacion.classList.remove('active');
          seccionDashboard.focus();
        }
      }

      btnEvaluacion.addEventListener('click', () => cambiarSeccion('evaluacion'));
      btnDashboard.addEventListener('click', () => cambiarSeccion('dashboard'));

      // --- Código existente para evaluación ---
      // Lista de requisitos iniciales
      const requisitos = [
        { id: 1, categoria: 'DOCUMENTACIÓN DE PRESENTACIÓN', descripcion: 'Entrega puntual conforme a las especificaciones establecidas, incluyendo el cumplimiento de sobre totalmente sellado.', estado: null },
        { id: 2, categoria: 'DOCUMENTACIÓN DE PRESENTACIÓN', descripcion: 'Carta de presentación de la propuesta', estado: null },
        { id: 3, categoria: 'DOCUMENTACIÓN DE PRESENTACIÓN', descripcion: 'Todos los documentos deberán incorporar una marca de agua visible con la leyenda "Uso Educativo"', estado: null },
        { id: 4, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Todos los documentos realizados por la empresa deberán tener su logo.', estado: null },
        { id: 5, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Copia de la cédula de ciudadanía de cada uno de los socios de la empresa.', estado: null },
        { id: 6, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Certificado de Existencia y Representación legal (cámara de comercio)', estado: null },
        { id: 7, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Acta de junta de socios o accionistas (autorización para contratar)', estado: null },
        { id: 8, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Certificados de Antecedentes Disciplinarios, Fiscales y Penales.', estado: null },
        { id: 9, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Póliza de seguro vigente.', estado: null },
        { id: 10, categoria: 'CAPACIDAD TÉCNICA Y DE TALENTO HUMANO', descripcion: 'Capacidad operacional Hojas de Vida y Soporte de los profesionales clave', estado: null },
        { id: 11, categoria: 'REQUISITOS FINANCIEROS Y ECONÓMICOS', descripcion: 'Requisitos financieros, Balance general, índice de liquidez.', estado: null },
        { id: 12, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Propuesta económica formato anexo al pliego de condiciones.', estado: null },
        { id: 13, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Análisis de riesgos y propuesta de mitigación.', estado: null },
        { id: 14, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Documentación técnica de la seguridad.', estado: null },
        { id: 15, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Propuesta de escalabilidad y mantenimiento a largo plazo.', estado: null },
        { id: 16, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Certificado de modelo de licenciamiento del software.', estado: null },
        { id: 17, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Carta de confidencialidad.', estado: null },
        { id: 18, categoria: 'PROPUESTA ECONÓMICA DETALLADA', descripcion: 'Formato de cotización componentes y servicios.', estado: null },
        { id: 19, categoria: 'PROPUESTA ECONÓMICA DETALLADA', descripcion: 'Análisis del valor total de la propuesta económica.', estado: null },
        { id: 20, categoria: 'PLANIFICACIÓN ESTRATÉGICA Y DE CAPACITACIÓN', descripcion: 'Plan claro de capacitación a los funcionarios de la entidad adquiriente del software.', estado: null },
        { id: 21, categoria: 'PLANIFICACIÓN ESTRATÉGICA Y DE CAPACITACIÓN', descripcion: 'Análisis de Innovación (Incluye mejoras tecnológicas).', estado: null },
        { id: 22, categoria: 'PLANIFICACIÓN ESTRATÉGICA Y DE CAPACITACIÓN', descripcion: 'Calidad y detalle de la documentación entregada y soporte ofrecido.', estado: null }
      ];

      // Estado interno
      const estado = {
        datosEvaluacion: {
          nombreEmpresa: '',
          nombreEvaluador: '',
          fecha: new Date().toISOString().split('T')[0],
          observaciones: ''
        },
        requisitos: JSON.parse(JSON.stringify(requisitos)) // copia profunda para no modificar original
      };

      // Selectores DOM evaluación
      const inputNombreEmpresa = document.getElementById('nombreEmpresa');
      const inputNombreEvaluador = document.getElementById('nombreEvaluador');
      const inputFecha = document.getElementById('fechaEvaluacion');
      const textareaObservaciones = document.getElementById('observaciones');
      const seccionRequisitos = document.querySelector('.requisitos');
      const contadorPuntaje = document.getElementById('contadorPuntaje');
      const porcentajeCumplimiento = document.getElementById('porcentajeCumplimiento');
      const botonExportar = document.getElementById('botonExportar');

      // Iconos SVG simples para categorías
      const iconos = {
        'DOCUMENTACIÓN': `<svg class="icono" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>`,
        'INSTITUCIONAL': `<svg class="icono" viewBox="0 0 24 24"><path d="M3 21v-8l9-4 9 4v8"/></svg>`,
        'TALENTO HUMANO': `<svg class="icono" viewBox="0 0 24 24"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7 7 0 0 1 13 0"/></svg>`,
        'FINANCIERO': `<svg class="icono" viewBox="0 0 24 24"><path d="M12 1v22"/><path d="M17 5H9a4 4 0 0 0 0 8h6a4 4 0 0 1 0 8H7"/></svg>`,
        'SEGURIDAD': `<svg class="icono" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>`,
        'ECONÓMICA': `<svg class="icono" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 12h8M12 8v8"/></svg>`,
        'PLANIFICACIÓN': `<svg class="icono" viewBox="0 0 24 24"><polyline points="4 17 10 11 13 14 20 7"/><circle cx="20" cy="7" r="2"/></svg>`
      };

      // Obtener icono según categoría
      function obtenerIcono(categoria) {
        if (categoria.includes('DOCUMENTACIÓN')) return iconos['DOCUMENTACIÓN'];
        if (categoria.includes('INSTITUCIONAL')) return iconos['INSTITUCIONAL'];
        if (categoria.includes('TALENTO HUMANO')) return iconos['TALENTO HUMANO'];
        if (categoria.includes('FINANCIERO')) return iconos['FINANCIERO'];
        if (categoria.includes('SEGURIDAD')) return iconos['SEGURIDAD'];
        if (categoria.includes('ECONÓMICA')) return iconos['ECONÓMICA'];
        if (categoria.includes('PLANIFICACIÓN')) return iconos['PLANIFICACIÓN'];
        return iconos['DOCUMENTACIÓN'];
      }

      // Agrupar requisitos por categoría
      function agruparRequisitos(lista) {
        return lista.reduce((acum, req) => {
          if (!acum[req.categoria]) acum[req.categoria] = [];
          acum[req.categoria].push(req);
          return acum;
        }, {});
      }

      // Renderizar requisitos en el DOM
      function renderizarRequisitos() {
        const agrupados = agruparRequisitos(estado.requisitos);
        seccionRequisitos.innerHTML = '';
        Object.entries(agrupados).forEach(([categoria, reqs]) => {
          const bloqueCategoria = document.createElement('div');
          bloqueCategoria.className = 'bloque-categoria';

          const encabezadoCategoria = document.createElement('div');
          encabezadoCategoria.className = 'encabezado-categoria';
          encabezadoCategoria.innerHTML = `${obtenerIcono(categoria)}<span>${categoria}</span>`;
          bloqueCategoria.appendChild(encabezadoCategoria);

          reqs.forEach(req => {
            const item = document.createElement('div');
            item.className = 'item-requisito';

            const info = document.createElement('div');
            info.className = 'info-requisito';

            const numero = document.createElement('span');
            numero.className = 'numero-requisito';
            numero.textContent = `N° ${req.id}`;
            info.appendChild(numero);

            const descripcion = document.createElement('p');
            descripcion.className = 'descripcion-requisito';
            descripcion.textContent = req.descripcion;
            info.appendChild(descripcion);

            item.appendChild(info);

            const grupoBotones = document.createElement('div');
            grupoBotones.className = 'grupo-botones';

            // Botón CUMPLE
            const botonCumple = document.createElement('button');
            botonCumple.type = 'button';
            botonCumple.className = 'boton-estado';
            botonCumple.setAttribute('aria-pressed', req.estado === true ? 'true' : 'false');
            botonCumple.innerHTML = `<svg class="icono" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> CUMPLE`;
            botonCumple.classList.toggle('cumple', req.estado === true);
            botonCumple.classList.toggle('neutro', req.estado !== true);
            botonCumple.addEventListener('click', () => actualizarEstadoRequisito(req.id, true));
            grupoBotones.appendChild(botonCumple);

            // Botón NO CUMPLE
            const botonNoCumple = document.createElement('button');
            botonNoCumple.type = 'button';
            botonNoCumple.className = 'boton-estado';
            botonNoCumple.setAttribute('aria-pressed', req.estado === false ? 'true' : 'false');
            botonNoCumple.innerHTML = `<svg class="icono" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> NO CUMPLE`;
            botonNoCumple.classList.toggle('no-cumple', req.estado === false);
            botonNoCumple.classList.toggle('neutro', req.estado !== false);
            botonNoCumple.addEventListener('click', () => actualizarEstadoRequisito(req.id, false));
            grupoBotones.appendChild(botonNoCumple);

            item.appendChild(grupoBotones);
            bloqueCategoria.appendChild(item);
          });

          seccionRequisitos.appendChild(bloqueCategoria);
        });
      }

      // Actualizar estado de requisito
      function actualizarEstadoRequisito(id, estadoNuevo) {
        const requisito = estado.requisitos.find(r => r.id === id);
        if (requisito) {
          requisito.estado = estadoNuevo;
          renderizarRequisitos();
          actualizarPuntajes();
        }
      }

      // Actualizar puntajes y porcentajes
      function actualizarPuntajes() {
        const cumplidos = estado.requisitos.filter(r => r.estado === true).length;
        const total = estado.requisitos.length;
        const porcentaje = total === 0 ? 0 : ((cumplidos / total) * 100).toFixed(1);
        contadorPuntaje.textContent = `${cumplidos}/${total}`;
        porcentajeCumplimiento.textContent = `${porcentaje}%`;
      }

      // Actualizar datos de evaluación desde inputs
      function actualizarDatosEvaluacion(campo, valor) {
        estado.datosEvaluacion[campo] = valor;
      }

      // Exportar resultados a JSON y descargar
      function exportarResultados() {
        const resultados = {
          informacionEvaluacion: estado.datosEvaluacion,
          puntaje: `${estado.requisitos.filter(r => r.estado === true).length}/${estado.requisitos.length}`,
          porcentajeCumplimiento: ((estado.requisitos.filter(r => r.estado === true).length / estado.requisitos.length) * 100).toFixed(1) + '%',
          requisitos: estado.requisitos.map(r => ({
            id: r.id,
            descripcion: r.descripcion,
            estado: r.estado === true ? 'CUMPLE' : r.estado === false ? 'NO CUMPLE' : 'NO EVALUADO'
          }))
        };
        const datosStr = JSON.stringify(resultados, null, 2);
        const blob = new Blob([datosStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const fechaSegura = (estado.datosEvaluacion.fecha || new Date().toISOString().split('T')[0]).replace(/:/g, '-');
        const empresaSegura = (estado.datosEvaluacion.nombreEmpresa || 'empresa').replace(/\s+/g, '_');
        a.href = url;
        a.download = `evaluacion_licitacion_${empresaSegura}_${fechaSegura}.json`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      // Inicializar inputs con valores
      function inicializarInputs() {
        inputNombreEmpresa.value = estado.datosEvaluacion.nombreEmpresa;
        inputNombreEvaluador.value = estado.datosEvaluacion.nombreEvaluador;
        inputFecha.value = estado.datosEvaluacion.fecha;
        textareaObservaciones.value = estado.datosEvaluacion.observaciones;
      }

      // Escuchar eventos de inputs
      inputNombreEmpresa.addEventListener('input', e => actualizarDatosEvaluacion('nombreEmpresa', e.target.value));
      inputNombreEvaluador.addEventListener('input', e => actualizarDatosEvaluacion('nombreEvaluador', e.target.value));
      inputFecha.addEventListener('input', e => actualizarDatosEvaluacion('fecha', e.target.value));
      textareaObservaciones.addEventListener('input', e => actualizarDatosEvaluacion('observaciones', e.target.value));
      botonExportar.addEventListener('click', exportarResultados);

      // Inicializar todo
      function iniciar() {
        inicializarInputs();
        renderizarRequisitos();
        actualizarPuntajes();
      }
      iniciar();

      // --- NUEVO: Dashboard importación y visualización ---

      const inputArchivo = document.getElementById('inputArchivo');
      const mensajeArchivo = document.getElementById('mensajeArchivo');
      const resumenDashboard = document.getElementById('resumenDashboard');
      const numCumple = document.getElementById('numCumple');
      const numNoCumple = document.getElementById('numNoCumple');
      const numNoEvaluado = document.getElementById('numNoEvaluado');
      const porcentajeDashboard = document.getElementById('porcentajeDashboard');
      const tablaResultados = document.getElementById('tablaResultados');

      inputArchivo.addEventListener('change', () => {
        mensajeArchivo.textContent = '';
        resumenDashboard.style.display = 'none';
        tablaResultados.innerHTML = '';

        const archivo = inputArchivo.files[0];
        if (!archivo) {
          mensajeArchivo.textContent = 'No se seleccionó ningún archivo.';
          return;
        }
        if (!archivo.name.endsWith('.json')) {
          mensajeArchivo.textContent = 'Por favor, seleccione un archivo JSON válido.';
          return;
        }

        const lector = new FileReader();
        lector.onload = (e) => {
          try {
            const datos = JSON.parse(e.target.result);
            if (!datos.requisitos || !Array.isArray(datos.requisitos)) {
              mensajeArchivo.textContent = 'Archivo JSON inválido o estructura no reconocida.';
              return;
            }

            // Contar estados
            let cumpleCount = 0;
            let noCumpleCount = 0;
            let noEvaluadoCount = 0;
            datos.requisitos.forEach(r => {
              if (r.estado === 'CUMPLE') cumpleCount++;
              else if (r.estado === 'NO CUMPLE') noCumpleCount++;
              else noEvaluadoCount++;
            });
            const total = datos.requisitos.length;
            const porcentaje = total === 0 ? 0 : ((cumpleCount / total) * 100).toFixed(1);

            // Mostrar resumen
            numCumple.textContent = cumpleCount;
            numNoCumple.textContent = noCumpleCount;
            numNoEvaluado.textContent = noEvaluadoCount;
            porcentajeDashboard.textContent = porcentaje + '%';

            // Mostrar tabla
            tablaResultados.innerHTML = '';
            datos.requisitos.forEach(r => {
              const tr = document.createElement('tr');
              const tdId = document.createElement('td');
              tdId.textContent = r.id;
              const tdDesc = document.createElement('td');
              tdDesc.textContent = r.descripcion;
              const tdEstado = document.createElement('td');
              tdEstado.textContent = r.estado;
              if (r.estado === 'CUMPLE') tdEstado.className = 'estado-cumple';
              else if (r.estado === 'NO CUMPLE') tdEstado.className = 'estado-no-cumple';
              else tdEstado.className = 'estado-no-evaluado';

              tr.appendChild(tdId);
              tr.appendChild(tdDesc);
              tr.appendChild(tdEstado);

              tablaResultados.appendChild(tr);
            });

            resumenDashboard.style.display = 'block';
            mensajeArchivo.textContent = '';

          } catch (error) {
            mensajeArchivo.textContent = 'Error al leer el archivo JSON: ' + error.message;
          }
        };
        lector.readAsText(archivo);
      });
    })();
  </script>
</body>
</html>


                                    
