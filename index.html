<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulario de Evaluación de Licitación</title>
  <style>
    /* Reset y base */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom right, #e0f2fe, #c7d2fe);
      min-height: 100vh;
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .contenedor {
      background: white;
      border-radius: 1rem;
      max-width: 960px;
      width: 100%;
      box-shadow: 0 25px 50px -12px rgba(99, 102, 241, 0.25);
      overflow: hidden;
    }

    /* Encabezado */
    .encabezado {
      background: linear-gradient(to right, #2563eb, #4f46e5);
      padding: 24px 32px;
      color: #e0e7ff;
    }
    .encabezado h1 {
      font-size: 2rem;
      font-weight: 700;
      margin: 0 0 6px 0;
    }
    .encabezado p {
      margin: 0;
      color: #bfdbfe;
    }

    /* Sección del formulario */
    .seccion-formulario {
      background: #f9fafb;
      border-bottom: 1px solid #e5e7eb;
      padding: 24px 32px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #374151;
    }
    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: box-shadow 0.2s ease;
      font-family: inherit;
    }
    input[type="text"]:focus,
    input[type="date"]:focus,
    textarea:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 5px 2px #3b82f6aa;
    }
    textarea {
      resize: vertical;
    }

    /* Resumen de puntuación */
    .resumen-puntaje {
      padding: 24px 32px;
      background: linear-gradient(to right, #ecfdf5, #e0f2fe);
      border-bottom: 1px solid #d1d5db;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      align-items: center;
      gap: 16px;
    }
    .grupo-puntaje {
      display: flex;
      gap: 48px;
      align-items: center;
    }
    .bloque-puntaje {
      text-align: center;
    }
    .bloque-puntaje .puntaje {
      font-size: 2.25rem;
      font-weight: 700;
      color: #2563eb;
      margin-bottom: 4px;
    }
    .bloque-puntaje.cumplimiento .puntaje {
      color: #16a34a;
    }
    .bloque-puntaje .etiqueta {
      font-size: 0.875rem;
      color: #4b5563;
    }
    .boton-exportar {
      padding: 12px 28px;
      background-color: #2563eb;
      color: white;
      border-radius: 0.5rem;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }
    .boton-exportar:hover {
      background-color: #1d4ed8;
    }

    /* Requisitos */
    .requisitos {
      padding: 32px;
    }
    .bloque-categoria {
      margin-bottom: 48px;
    }
    .encabezado-categoria {
      display: flex;
      align-items: center;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 8px;
      margin-bottom: 20px;
      color: #374151;
      font-weight: 700;
      font-size: 1.25rem;
      gap: 8px;
    }
    .item-requisito {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 16px 20px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
      transition: box-shadow 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .item-requisito:hover {
      box-shadow: 0 5px 15px rgb(0 0 0 / 0.15);
    }
    .info-requisito {
      flex: 1;
    }
    .numero-requisito {
      background: #f3f4f6;
      color: #374151;
      font-weight: 600;
      font-size: 0.875rem;
      padding: 3px 10px;
      border-radius: 0.5rem;
      margin-bottom: 6px;
      display: inline-block;
    }
    .descripcion-requisito {
      color: #4b5563;
      line-height: 1.4;
    }
    .grupo-botones {
      display: flex;
      gap: 10px;
      margin-left: 16px;
      flex-shrink: 0;
    }
    button.boton-estado {
      display: flex;
      align-items: center;
      gap: 6px;
      border-radius: 0.5rem;
      font-weight: 600;
      font-size: 0.875rem;
      padding: 8px 14px;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      user-select: none;
    }
    button.boton-estado svg {
      width: 16px;
      height: 16px;
    }
    button.cumple {
      background-color: #22c55e;
      color: white;
      box-shadow: 0 5px 10px rgb(34 197 94 / 0.6);
    }
    button.cumple:hover {
      background-color: #16a34a;
    }
    button.no-cumple {
      background-color: #ef4444;
      color: white;
      box-shadow: 0 5px 10px rgb(239 68 68 / 0.6);
    }
    button.no-cumple:hover {
      background-color: #b91c1c;
    }
    button.neutro {
      background-color: #f3f4f6;
      color: #4b5563;
    }
    button.neutro:hover {
      background-color: #d1d5db;
      color: #1f2937;
    }

    /* Observaciones */
    .observaciones {
      background: #f9fafb;
      border-top: 1px solid #e5e7eb;
      padding: 24px 32px;
    }
    .observaciones label {
      font-size: 1.125rem;
      font-weight: 700;
      color: #374151;
      margin-bottom: 12px;
      display: block;
    }
    .observaciones textarea {
      width: 100%;
      min-height: 100px;
      font-size: 1rem;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      font-family: inherit;
      resize: vertical;
      transition: box-shadow 0.3s ease;
    }
    .observaciones textarea:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 5px 2px #3b82f6aa;
    }

    /* Pie de página */
    .pie-pagina {
      background: #f3f4f6;
      padding: 16px 32px;
      text-align: center;
      font-size: 0.875rem;
      color: #6b7280;
    }

    /* Iconos SVG */
    .icono {
      width: 20px;
      height: 20px;
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    /* Color iconos categoria */
    .encabezado-categoria svg {
      color: #2563eb;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .resumen-puntaje {
        flex-direction: column;
        align-items: flex-start;
      }
      .grupo-puntaje {
        gap: 32px;
        margin-bottom: 12px;
      }
      .boton-exportar {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <main class="contenedor" role="main" aria-label="Formulario de Evaluación de Licitación">
    <!-- Encabezado -->
    <header class="encabezado">
      <h1>Formulario de Evaluación de Licitación</h1>
      <p>Evaluación de cumplimiento de requisitos técnicos</p>
    </header>

    <!-- Información Empresa y Evaluador -->
    <section class="seccion-formulario" aria-label="Información de la empresa y evaluador">
      <div>
        <label for="nombreEmpresa">Nombre de la Empresa</label>
        <input id="nombreEmpresa" type="text" placeholder="Ingrese el nombre de la empresa" />
      </div>
      <div>
        <label for="nombreEvaluador">Nombre del Evaluador</label>
        <input id="nombreEvaluador" type="text" placeholder="Ingrese su nombre" />
      </div>
      <div>
        <label for="fechaEvaluacion">
          Fecha
          <span aria-hidden="true">📅</span>
        </label>
        <input id="fechaEvaluacion" type="date" />
      </div>
    </section>

    <!-- Resumen de Puntaje -->
    <section class="resumen-puntaje" aria-live="polite" aria-atomic="true">
      <div class="grupo-puntaje">
        <div class="bloque-puntaje" aria-label="Requisitos cumplidos">
          <div class="puntaje" id="contadorPuntaje">0/22</div>
          <div class="etiqueta">Requisitos Cumplidos</div>
        </div>
        <div class="bloque-puntaje cumplimiento" aria-label="Porcentaje de cumplimiento">
          <div class="puntaje" id="porcentajeCumplimiento">0.0%</div>
          <div class="etiqueta">Cumplimiento</div>
        </div>
      </div>
      <button class="boton-exportar" id="botonExportar" type="button" aria-label="Exportar resultados de evaluación">Exportar Resultados</button>
    </section>

    <!-- Requisitos -->
    <section class="requisitos" aria-label="Lista de requisitos para evaluación">
      <!-- Aquí se inyectarán los requisitos -->
    </section>

    <!-- Observaciones -->
    <section class="observaciones">
      <label for="observaciones">Observaciones:</label>
      <textarea id="observaciones" placeholder="Ingrese observaciones adicionales sobre la evaluación..."></textarea>
    </section>

    <!-- Pie de página -->
    <footer class="pie-pagina">
      <p><strong>Sistema de Puntuación:</strong> CUMPLE = 1 PUNTO | NO CUMPLE = 0 PUNTOS</p>
    </footer>
  </main>

  <script>
    (() => {
      // Lista de requisitos iniciales
      const requisitos = [
        { id: 1, categoria: 'DOCUMENTACIÓN DE PRESENTACIÓN', descripcion: 'Entrega puntual conforme a las especificaciones establecidas, incluyendo el cumplimiento de sobre totalmente sellado.', estado: null },
        { id: 2, categoria: 'DOCUMENTACIÓN DE PRESENTACIÓN', descripcion: 'Carta de presentación de la propuesta', estado: null },
        { id: 3, categoria: 'DOCUMENTACIÓN DE PRESENTACIÓN', descripcion: 'Todos los documentos deberán incorporar una marca de agua visible con la leyenda "Uso Educativo"', estado: null },
        { id: 4, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Todos los documentos realizados por la empresa deberán tener su logo.', estado: null },
        { id: 5, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Copia de la cédula de ciudadanía de cada uno de los socios de la empresa.', estado: null },
        { id: 6, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Certificado de Existencia y Representación legal (cámara de comercio)', estado: null },
        { id: 7, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Acta de junta de socios o accionistas (autorización para contratar)', estado: null },
        { id: 8, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Certificados de Antecedentes Disciplinarios, Fiscales y Penales.', estado: null },
        { id: 9, categoria: 'DOCUMENTACIÓN INSTITUCIONAL Y LEGAL', descripcion: 'Póliza de seguro vigente.', estado: null },
        { id: 10, categoria: 'CAPACIDAD TÉCNICA Y DE TALENTO HUMANO', descripcion: 'Capacidad operacional Hojas de Vida y Soporte de los profesionales clave', estado: null },
        { id: 11, categoria: 'REQUISITOS FINANCIEROS Y ECONÓMICOS', descripcion: 'Requisitos financieros, Balance general, índice de liquidez.', estado: null },
        { id: 12, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Propuesta económica formato anexo al pliego de condiciones.', estado: null },
        { id: 13, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Análisis de riesgos y propuesta de mitigación.', estado: null },
        { id: 14, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Documentación técnica de la seguridad.', estado: null },
        { id: 15, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Propuesta de escalabilidad y mantenimiento a largo plazo.', estado: null },
        { id: 16, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Certificado de modelo de licenciamiento del software.', estado: null },
        { id: 17, categoria: 'SEGURIDAD Y LEGALIDAD DEL SOFTWARE', descripcion: 'Carta de confidencialidad.', estado: null },
        { id: 18, categoria: 'PROPUESTA ECONÓMICA DETALLADA', descripcion: 'Formato de cotización componentes y servicios.', estado: null },
        { id: 19, categoria: 'PROPUESTA ECONÓMICA DETALLADA', descripcion: 'Análisis del valor total de la propuesta económica.', estado: null },
        { id: 20, categoria: 'PLANIFICACIÓN ESTRATÉGICA Y DE CAPACITACIÓN', descripcion: 'Plan claro de capacitación a los funcionarios de la entidad adquiriente del software.', estado: null },
        { id: 21, categoria: 'PLANIFICACIÓN ESTRATÉGICA Y DE CAPACITACIÓN', descripcion: 'Análisis de Innovación (Incluye mejoras tecnológicas).', estado: null },
        { id: 22, categoria: 'PLANIFICACIÓN ESTRATÉGICA Y DE CAPACITACIÓN', descripcion: 'Calidad y detalle de la documentación entregada y soporte ofrecido.', estado: null }
      ];

      // Estado interno
      const estado = {
        datosEvaluacion: {
          nombreEmpresa: '',
          nombreEvaluador: '',
          fecha: new Date().toISOString().split('T')[0],
          observaciones: ''
        },
        requisitos: JSON.parse(JSON.stringify(requisitos)) // copia profunda para no modificar original
      };

      // Selectores DOM
      const inputNombreEmpresa = document.getElementById('nombreEmpresa');
      const inputNombreEvaluador = document.getElementById('nombreEvaluador');
      const inputFecha = document.getElementById('fechaEvaluacion');
      const textareaObservaciones = document.getElementById('observaciones');
      const seccionRequisitos = document.querySelector('.requisitos');
      const contadorPuntaje = document.getElementById('contadorPuntaje');
      const porcentajeCumplimiento = document.getElementById('porcentajeCumplimiento');
      const botonExportar = document.getElementById('botonExportar');

      // Iconos SVG simples para categorías
      const iconos = {
        'DOCUMENTACIÓN': `<svg class="icono" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>`,
        'INSTITUCIONAL': `<svg class="icono" viewBox="0 0 24 24"><path d="M3 21v-8l9-4 9 4v8"/></svg>`,
        'TALENTO HUMANO': `<svg class="icono" viewBox="0 0 24 24"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7 7 0 0 1 13 0"/></svg>`,
        'FINANCIERO': `<svg class="icono" viewBox="0 0 24 24"><path d="M12 1v22"/><path d="M17 5H9a4 4 0 0 0 0 8h6a4 4 0 0 1 0 8H7"/></svg>`,
        'SEGURIDAD': `<svg class="icono" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>`,
        'ECONÓMICA': `<svg class="icono" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 12h8M12 8v8"/></svg>`,
        'PLANIFICACIÓN': `<svg class="icono" viewBox="0 0 24 24"><polyline points="4 17 10 11 13 14 20 7"/><circle cx="20" cy="7" r="2"/></svg>`
      };

      // Obtener icono según categoría
      function obtenerIcono(categoria) {
        if (categoria.includes('DOCUMENTACIÓN')) return iconos['DOCUMENTACIÓN'];
        if (categoria.includes('INSTITUCIONAL')) return iconos['INSTITUCIONAL'];
        if (categoria.includes('TALENTO HUMANO')) return iconos['TALENTO HUMANO'];
        if (categoria.includes('FINANCIERO')) return iconos['FINANCIERO'];
        if (categoria.includes('SEGURIDAD')) return iconos['SEGURIDAD'];
        if (categoria.includes('ECONÓMICA')) return iconos['ECONÓMICA'];
        if (categoria.includes('PLANIFICACIÓN')) return iconos['PLANIFICACIÓN'];
        return iconos['DOCUMENTACIÓN'];
      }

      // Agrupar requisitos por categoría
      function agruparRequisitos(lista) {
        return lista.reduce((acum, req) => {
          if (!acum[req.categoria]) acum[req.categoria] = [];
          acum[req.categoria].push(req);
          return acum;
        }, {});
      }

      // Renderizar requisitos en el DOM
      function renderizarRequisitos() {
        const agrupados = agruparRequisitos(estado.requisitos);
        seccionRequisitos.innerHTML = '';
        Object.entries(agrupados).forEach(([categoria, reqs]) => {
          const bloqueCategoria = document.createElement('div');
          bloqueCategoria.className = 'bloque-categoria';

          const encabezadoCategoria = document.createElement('div');
          encabezadoCategoria.className = 'encabezado-categoria';
          encabezadoCategoria.innerHTML = `${obtenerIcono(categoria)}<span>${categoria}</span>`;
          bloqueCategoria.appendChild(encabezadoCategoria);

          reqs.forEach(req => {
            const item = document.createElement('div');
            item.className = 'item-requisito';

            const info = document.createElement('div');
            info.className = 'info-requisito';

            const numero = document.createElement('span');
            numero.className = 'numero-requisito';
            numero.textContent = `N° ${req.id}`;
            info.appendChild(numero);

            const descripcion = document.createElement('p');
            descripcion.className = 'descripcion-requisito';
            descripcion.textContent = req.descripcion;
            info.appendChild(descripcion);

            item.appendChild(info);

            const grupoBotones = document.createElement('div');
            grupoBotones.className = 'grupo-botones';

            // Botón CUMPLE
            const botonCumple = document.createElement('button');
            botonCumple.type = 'button';
            botonCumple.className = 'boton-estado';
            botonCumple.setAttribute('aria-pressed', req.estado === true ? 'true' : 'false');
            botonCumple.innerHTML = `<svg class="icono" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg> CUMPLE`;
            botonCumple.classList.toggle('cumple', req.estado === true);
            botonCumple.classList.toggle('neutro', req.estado !== true);
            botonCumple.addEventListener('click', () => actualizarEstadoRequisito(req.id, true));
            grupoBotones.appendChild(botonCumple);

            // Botón NO CUMPLE
            const botonNoCumple = document.createElement('button');
            botonNoCumple.type = 'button';
            botonNoCumple.className = 'boton-estado';
            botonNoCumple.setAttribute('aria-pressed', req.estado === false ? 'true' : 'false');
            botonNoCumple.innerHTML = `<svg class="icono" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg> NO CUMPLE`;
            botonNoCumple.classList.toggle('no-cumple', req.estado === false);
            botonNoCumple.classList.toggle('neutro', req.estado !== false);
            botonNoCumple.addEventListener('click', () => actualizarEstadoRequisito(req.id, false));
            grupoBotones.appendChild(botonNoCumple);

            item.appendChild(grupoBotones);
            bloqueCategoria.appendChild(item);
          });

          seccionRequisitos.appendChild(bloqueCategoria);
        });
      }

      // Actualizar estado de requisito
      function actualizarEstadoRequisito(id, estadoNuevo) {
        const requisito = estado.requisitos.find(r => r.id === id);
        if (requisito) {
          requisito.estado = estadoNuevo;
          renderizarRequisitos();
          actualizarPuntajes();
        }
      }

      // Actualizar puntajes y porcentajes
      function actualizarPuntajes() {
        const cumplidos = estado.requisitos.filter(r => r.estado === true).length;
        const total = estado.requisitos.length;
        const porcentaje = total === 0 ? 0 : ((cumplidos / total) * 100).toFixed(1);
        contadorPuntaje.textContent = `${cumplidos}/${total}`;
        porcentajeCumplimiento.textContent = `${porcentaje}%`;
      }

      // Actualizar datos de evaluación desde inputs
      function actualizarDatosEvaluacion(campo, valor) {
        estado.datosEvaluacion[campo] = valor;
      }

      // Exportar resultados a JSON y descargar
      function exportarResultados() {
        const resultados = {
          informacionEvaluacion: estado.datosEvaluacion,
          puntaje: `${estado.requisitos.filter(r => r.estado === true).length}/${estado.requisitos.length}`,
          porcentajeCumplimiento: ((estado.requisitos.filter(r => r.estado === true).length / estado.requisitos.length) * 100).toFixed(1) + '%',
          requisitos: estado.requisitos.map(r => ({
            id: r.id,
            descripcion: r.descripcion,
            estado: r.estado === true ? 'CUMPLE' : r.estado === false ? 'NO CUMPLE' : 'NO EVALUADO'
          }))
        };
        const datosStr = JSON.stringify(resultados, null, 2);
        const blob = new Blob([datosStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        const fechaSegura = (estado.datosEvaluacion.fecha || new Date().toISOString().split('T')[0]).replace(/:/g, '-');
        const empresaSegura = (estado.datosEvaluacion.nombreEmpresa || 'empresa').replace(/\s+/g, '_');
        a.href = url;
        a.download = `evaluacion_licitacion_${empresaSegura}_${fechaSegura}.json`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      }

      // Inicializar inputs con valores
      function inicializarInputs() {
        inputNombreEmpresa.value = estado.datosEvaluacion.nombreEmpresa;
        inputNombreEvaluador.value = estado.datosEvaluacion.nombreEvaluador;
        inputFecha.value = estado.datosEvaluacion.fecha;
        textareaObservaciones.value = estado.datosEvaluacion.observaciones;
      }

      // Escuchar eventos de inputs
      inputNombreEmpresa.addEventListener('input', e => actualizarDatosEvaluacion('nombreEmpresa', e.target.value));
      inputNombreEvaluador.addEventListener('input', e => actualizarDatosEvaluacion('nombreEvaluador', e.target.value));
      inputFecha.addEventListener('input', e => actualizarDatosEvaluacion('fecha', e.target.value));
      textareaObservaciones.addEventListener('input', e => actualizarDatosEvaluacion('observaciones', e.target.value));
      botonExportar.addEventListener('click', exportarResultados);

      // Inicializar todo
      function iniciar() {
        inicializarInputs();
        renderizarRequisitos();
        actualizarPuntajes();
      }

      iniciar();
    })();
  </script>
</body>
</html>

